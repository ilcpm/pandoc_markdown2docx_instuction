# 需要实现的功能

## 还没有思路

* 自定义多**节**的页眉页脚
  * 位于单独的xml文件中，不能通过在正文中插入xml实现
  * 可能可以通过引用reference.docx实现对多节页眉页脚的直接插入
  * 原生实现方式：
    * 多节的页眉页脚分成多个header.xml和footer.xml文件记录
    * 在.rels文件中规定“关系”，指定对应xml文件`r:id`属性的值，如果没有该属性，则无法将对应的页眉页脚文件对应到该节，报错
    * pandoc在引用refer.docx的时候复制了所有的xml文件，但是没有复制.rels文件，所以无法提早知道生成的新docx里面的xml的`r:id`值
    * **无法通过指定ooxml实现**
* 表格的便捷插入
  * 暂不知道如何实现
  * 一种思路是每个表格放入单独docx文件，通过复制正文xml实现
* yaml配置文件
  * 最后写插件时来考虑
* 插入封面（单独的文件）
  * 复制指定文件的正文xml部分导入

---

* 页眉页脚的一个思路
  * 查看pandoc基于模版输出时是否会改变docx中的.rels中记录的`r:id`
  * 如果没有改变，可以在python中解析`r:id`即可知道页眉页脚对应的xml文件id，然后在正文中手动指定

## 确认了思路

* **通过编程实现pandoc数据结构的修改，插入对应的“数值类型”，修改“数值类型”**
* 取消指定标题的编号
  * 参考lua-filter的做法，定义编号了的标题样式和没有编号的标题样式，直接调用对应的样式
* 在指定位置插入域代码以实现图片表格的题注的原生实现（即编号）
  * 公式已实现
* 通过指定yaml实现如`图 1-3`，`图 22`的实现（不需要手动计算编号，Word自动计算）
  * 向pandoc的fileer插件提pr，直接在原来基础上对Word插入ooxml

## 已经完成技术验证

**指定位置的ooxml插入！**✌

### 特殊符号

* 插入分节符（并非特殊字符）
  * 一段ooxml
* 指定位置特殊字符插入
  * 分页符
  * **制表符**
  * **特殊的页面居中&右对齐制表符**

### 摘要&目录

* 需求：
  * 摘要和附录需要支持多个一级标题
  * 摘要位于封面后方目录前方
* 实现思路：
  * 在任意位置插入目录
  * 在任意位置插入参考文献
* 具体实现：
  * 绕过pandoc原始的目录和参考文献生成，用自定义的命令在任意位置插入目录和参考文献
  * 目录通过插入ooxml代码实现
  * 参考文献通过pandoc文档中`caption`节中`Placement of the bibliography`段落的div实现

### 题注

* 需求：
  * 实现原生的题注插入（公式编号，表格编号，图片题注编号）
* 实现思路：
  * 指定位置域代码插入
    * 通过域代码的插入实现题注
  * 指定区间书签标记
    * 为了实现原生的交叉引用，需要进行书签标注
* 具体实现：
  * 对指定区间前后插入ooxml进行书签标记
  * 对段落级别（如题注的部分）的部分应用书签可在段落层次插入书签代码
  * （公式编号已原生实现）

### 标题编号

* 标题编号（Word模版中对标题样式绑定编号）
  * from lua-filter
  * 标题样式定义两次，两个名字，需要编号和不需要编号的套用不同的样式

### 自定义样式

* 套用模版中的自定义样式
  * pandoc手册P119，from 郭俊余
  * 若样式不存在，则会自动创建
