# 开题答辩

## 项目来源与背景——毕业论文排版难

### LaTeX行不通

* 众所周知，论文排版通常使用Word和LaTeX，众多致命高效同时提供了对两种方式的提交支持，且提供了官方的LaTeX模版。
* 而我校虽然身985高校，却迟迟没有提供对LaTeX的支持，更遑论官方的LaTeX模版。虽然学校要求使用Word输出的PDF提交，但自行使用LaTeX排版的论文可能会因为与Word的实现效果不同而受到“责难”，同时如果被抽到送审查重，是需要提供Word版本的论文的。

因此，虽然LaTeX输出的PDF在文件格式上是“兼容”的，也有前辈做出了LaTeX的模版，但还是需要自行承担排版格式不被认可的风险，哪怕这样，LaTeX也存在

* 学习成本极高，需要较强的动手能力，编程素养和学习能力
* 编译缓慢，每次编译需要花费十秒左右的编译时间
* 缺少相关支持和学习环境，遇到问题难以请教

等问题。

而如果格式不通过，需要学习大量LaTeX格式知识手动调整，也就失去LaTeX的意义了

因此，对于学生而言，使用Word仍然是成本最低最保险的选择。

### Word不好用

但是Word却又面临

* 学校并未提供模版，需要手动反复调整格式
  * 而大部分学生并不具备该能力，排出的论文在格式上杂乱无章
  * 甚至学校给出的排版范例本身的格式也并不符合排版规范
* 即使有模版，大部分学生并不会使用Word的`样式`功能，也就不会使用模版

即使解决模版问题，仍有

* 公式输入极其繁琐
* 公式编号困难
* 页眉页脚目录等复杂功能仍需要手动设置
* 参考文献插入软件不稳定，容易崩溃

等问题

## 解决方案

已有论文（主要是各个计算机学院的本科毕业论文）的主要方案是，使用各种语言构建图形化操作界面，调用win32接口利用VBA操纵Word，通过简单的查找替换和正则表达式匹配，实现将纯文本编号，替换为Word原生编号，以及匹配`标题`样式等功能。这样的做法通常需要对Word排版不熟悉的学生先用“纯文本”的“土办法”把各个编号写好，且对于Word小白排出的各种杂乱格式不能做到完全匹配和疏通，还容易改出新的排版问题。

因此已有的论文方案并不能很好的改善Word排版自动化难的问题。

### 通用转换器pandoc

pandoc是一个开源的“通用的文档转换器”，可以实现对`.docx`，`.html`，`.tex`，甚至是`pptx`格式！

### markdown

## 实现思路

### pandoc原生功能部分

### 需要实现的功能

* 插入封面（单独的文件）
  * 复制指定文件的正文xml部分导入
* 摘要附录（需要支持多个一级标题）
* 摘要位于封面后方目录前方
* 附录位于参考文献后方
* 目录
* 指定位置特殊字符插入
  * 分页符
  * 制表符
  * 特殊的页面居中&右对齐制表符
* 插入分节符（并非特殊字符）
  * 一段ooxml
* 自定义多**节**的页眉页脚
  * 位于单独的xml文件中，不能通过在正文中插入xml实现
  * 可能可以通过引用reference.docx实现对多节页眉页脚的直接插入
  * 原生实现方式：
    * 多节的页眉页脚分成多个header.xml和footer.xml文件记录
    * 在.rels文件中规定“关系”，指定对应xml文件`r:id`属性的值，如果没有该属性，则无法将对应的页眉页脚文件对应到该节，报错
    * pandoc在引用refer.docx的时候复制了所有的xml文件，但是没有复制.rels文件，所以无法提早知道生成的新docx里面的xml的`r:id`值
    * **无法通过指定ooxml实现**
* 在指定位置插入域代码以实现图片公式表格的题注的原生实现（即编号）
  * 通过指定yaml实现如`图 1-3`，`图 22`的实现（不需要手动计算编号，Word自动计算）
  * 为了实现原生的交叉引用，需要进行书签标注
* 指定区间书签标记
  * 对指定区间前后插入书签标记内容
* 标题编号（Word模版中对标题样式绑定编号）
* 取消指定标题的编号
  * （暂不知道具体操作步骤）
* 表格的便捷插入
  * 暂不知道如何实现
  * 一种思路是每个表格放入单独docx文件，通过复制正文xml实现

<!-- 
这部分网络上已经有人总结的差不多了

### 需要编程手动实现的部分

除去pandoc的原生支持功能，pandoc还支持插件，可以实现更多的 -->

## 技术路线

## 预期规划
